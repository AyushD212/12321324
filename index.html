<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Redirect Generator</title>
<style>
html,body {height:100%; margin:0; padding:0; font-family:Arial,sans-serif; background:#f8f9fa; color:#111;}
.section {border:1px solid #e0e0e0; padding:14px; border-radius:8px; margin:18px auto; max-width:960px; background:#fff;}
input[type="text"] {width:72%; padding:8px; border:1px solid #ccc; border-radius:4px;}
button {padding:8px 12px; border-radius:6px; border:0; background:#0366d6; color:#fff; cursor:pointer;}
.sample {word-break:break-all; color:#0366d6; text-decoration:none;}
#verify-screen {display:none; align-items:center; justify-content:center; height:100vh; background:#f8f9fa;}
#verify-box {background:#fff; padding:30px; border-radius:10px; box-shadow:0 4px 16px rgba(0,0,0,0.1); text-align:center;}
h2 {font-weight:500; margin-bottom:14px;}
</style>

<!-- Cloudflare Turnstile -->
<script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>

<script>
// ----------------------- CONFIG -----------------------
const CONFIG = {
    PUBLIC_HOST: window.location.origin + window.location.pathname,
    TURNSTILE_SITE_KEY: '0x4AAAAAAB_GRO5x_mAh22NL',   // Your site key
    TURNSTILE_SECRET:   '0x4AAAAAAB_GRFJDhxRtMixQFQ7ujsuO8e4' // Your secret key
};

// ----------------------- UUID helper -----------------------
function uuid(){ return crypto.randomUUID ? crypto.randomUUID() : 'id-'+Math.random().toString(36).slice(2,12); }

// ----------------------- Base64 helpers -----------------------
function arrayBufferToBase64(buffer){
    let binary=''; const bytes=new Uint8Array(buffer);
    for(let i=0;i<bytes.byteLength;i++) binary+=String.fromCharCode(bytes[i]);
    return btoa(binary);
}
function base64ToArrayBuffer(base64){
    const binary=atob(base64); const bytes=new Uint8Array(binary.length);
    for(let i=0;i<binary.length;i++) bytes[i]=binary.charCodeAt(i);
    return bytes.buffer;
}

// ----------------------- AES encryption -----------------------
async function generateAESKey(){ return crypto.subtle.generateKey({name:"AES-GCM", length:256}, true, ["encrypt","decrypt"]); }

async function encryptPayload(payload){
    // Step 1: Add random padding
    const padding = Array.from({length:16},()=>Math.floor(Math.random()*256));
    payload.pad = padding;

    // Step 2: First AES encryption
    const key1 = await generateAESKey();
    const iv1 = crypto.getRandomValues(new Uint8Array(12));
    const data1 = new TextEncoder().encode(JSON.stringify(payload));
    const enc1 = await crypto.subtle.encrypt({name:"AES-GCM", iv:iv1}, key1, data1);
    const rawKey1 = await crypto.subtle.exportKey("raw", key1);

    // Step 3: Second AES encryption (encrypt the first encrypted data)
    const key2 = await generateAESKey();
    const iv2 = crypto.getRandomValues(new Uint8Array(12));
    const enc2 = await crypto.subtle.encrypt({name:"AES-GCM", iv:iv2}, key2, enc1);
    const rawKey2 = await crypto.subtle.exportKey("raw", key2);

    // Step 4: Obfuscate keys & IVs
    const encoded = [
        arrayBufferToBase64(enc2),
        arrayBufferToBase64(iv2),
        arrayBufferToBase64(rawKey2),
        arrayBufferToBase64(iv1),
        arrayBufferToBase64(rawKey1)
    ].map(s=>btoa(s)).join('.'); // double base64 for extra obfuscation

    return encoded;
}

// ----------------------- AES decryption -----------------------
async function decryptPayload(encStr){
    try{
        const parts = encStr.split('.').map(s=>atob(s));
        const [enc2B64, iv2B64, key2B64, iv1B64, key1B64] = parts;
        const enc2 = base64ToArrayBuffer(enc2B64);
        const iv2 = base64ToArrayBuffer(iv2B64);
        const key2Raw = base64ToArrayBuffer(key2B64);
        const key2 = await crypto.subtle.importKey("raw", key2Raw, "AES-GCM", true, ["decrypt"]);

        const enc1 = await crypto.subtle.decrypt({name:"AES-GCM", iv:iv2}, key2, enc2);

        const iv1 = base64ToArrayBuffer(iv1B64);
        const key1Raw = base64ToArrayBuffer(key1B64);
        const key1 = await crypto.subtle.importKey("raw", key1Raw, "AES-GCM", true, ["decrypt"]);

        const decrypted = await crypto.subtle.decrypt({name:"AES-GCM", iv:iv1}, key1, enc1);
        return JSON.parse(new TextDecoder().decode(decrypted));
    } catch(e){ return null; }
}

// ----------------------- Random page titles -----------------------
const pageTitles = ["Explore New Horizons","Hidden Journey","Mystery Path","Secret Portal","Adventure Awaits","The Unknown","Secret Passage","Lost Trail","Enchanted Gateway","Whispering Woods"];
document.title = pageTitles[Math.floor(Math.random()*pageTitles.length)];

// ----------------------- DOM events -----------------------
window.addEventListener('DOMContentLoaded', async ()=>{
    const params = new URLSearchParams(location.search);
    const w = params.get('w');
    if(!w){ document.getElementById('generator').style.display='block'; return; }

    // Show verify screen
    document.getElementById('verify-screen').style.display='flex';
    const btn = document.getElementById('continueBtn'); let verified=false;

    window.onTurnstileSuccess = function(token){ verified=true; btn.disabled=false; btn.textContent='Continue'; };

    btn.addEventListener('click', async ()=>{
        if(!verified){ alert('Please complete the verification first.'); return; }
        btn.disabled=true; btn.textContent='Redirecting...';
        const payload = await decryptPayload(decodeURIComponent(w));
        if(!payload||!payload.u){ document.body.innerHTML='<p style="text-align:center;color:red;">Invalid or malformed link.</p>'; return; }
        window.location.href = payload.u;
    });
});

// ----------------------- Link generator -----------------------
async function generateLink(){
    const dest = document.getElementById('targetInput').value.trim();
    if(!dest) return alert('Enter a destination URL.');
    const payload = {u:dest, r:uuid(), t:Date.now()};
    const encStr = await encryptPayload(payload);
    const final = `${CONFIG.PUBLIC_HOST}?w=${encodeURIComponent(encStr)}`;
    document.getElementById('generated').innerHTML = `<div><strong>Encoded link:</strong><br/><a class="sample" href="${final}" target="_blank">${final}</a></div>`;
}

// ----------------------- Anti-devtools & F12 -----------------------
(function(){
    const threshold = 160;
    let devtoolsOpen = false;

    const blockDevTools = () => {
        const widthThreshold = window.outerWidth - window.innerWidth > threshold;
        const heightThreshold = window.outerHeight - window.innerHeight > threshold;
        if(widthThreshold || heightThreshold) {
            if(!devtoolsOpen){
                devtoolsOpen = true;
                document.body.innerHTML = '<h1 style="text-align:center;color:red;margin-top:20%;">Access Denied</h1>';
                document.body.style.pointerEvents='none';
                document.body.style.userSelect='none';
            }
        } else { devtoolsOpen = false; }
    };

    setInterval(blockDevTools, 500);
    window.addEventListener('resize', blockDevTools);
    window.addEventListener('keydown', e=>{
        if(e.key==='F12' || (e.ctrlKey && e.shiftKey && ['I','J','C'].includes(e.key.toUpperCase()))) {
            e.preventDefault(); blockDevTools();
        }
    });
    window.addEventListener('contextmenu', e=>e.preventDefault());
})();
</script>
</head>

<body>

<!-- Generator section -->
<div id="generator" class="section" style="display:none;">
<h2>Generate an encoded redirect link</h2>
<input id="targetInput" type="text" placeholder="Enter destination URL (e.g. https://example.com)" />
<button onclick="generateLink()">Generate</button>
<div id="generated" style="margin-top:12px;"></div>
<div style="margin-top:10px;color:#666;font-size:13px;">All generated links will start with:<br/><code style="word-break:break-all;">${window.location.origin}${window.location.pathname}</code></div>
</div>

<!-- Verify screen -->
<div id="verify-screen">
<div id="verify-box">
<h2>Verify to Continue</h2>
<div class="cf-turnstile" data-sitekey="0x4AAAAAAB_GRO5x_mAh22NL" data-callback="onTurnstileSuccess"></div>
<button id="continueBtn" disabled>Waiting for verification...</button>
</div>
</div>

</body>
</html>
